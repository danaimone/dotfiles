{{- if eq .chezmoi.os "darwin" -}}
#!/bin/bash

set -e

echo "üîê Checking 1Password CLI integration..."

# Check if 1Password CLI is installed
if ! command -v op &> /dev/null; then
    echo "‚ö†Ô∏è  1Password CLI not found. It should be installed via Homebrew."
    echo "   Run: brew install --cask 1password-cli"
    exit 0
fi

# Check if 1Password CLI can connect to the app
if ! op account list &> /dev/null; then
    echo ""
    echo "‚ö†Ô∏è  1Password CLI is not connected to the 1Password app."
    echo ""
    echo "üìã To enable 1Password CLI integration:"
    echo "   1. Open the 1Password desktop app"
    echo "   2. Go to Settings ‚Üí Developer"
    echo "   3. Enable 'Connect with 1Password CLI'"
    echo ""
    echo "   After enabling, your SSH config will automatically pull"
    echo "   connection details from 1Password when you run 'chezmoi apply'."
    echo ""
    exit 0
fi

# Check if user is signed in
if ! op whoami &> /dev/null 2>&1; then
    echo "‚ÑπÔ∏è  1Password CLI is configured but not signed in."
    echo "   The CLI will authenticate via the desktop app when needed."
else
    echo "‚úÖ 1Password CLI is connected and ready!"
fi

{{ end -}}
